import{_ as a,V as p,W as t,X as e,Y as n,Z as o,a0 as c,C as i}from"./framework-a727d17b.js";const l={},r=n("h1",{id:"动态更新域名解析地址-以-cloudflare-为例",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#动态更新域名解析地址-以-cloudflare-为例","aria-hidden":"true"},"#"),o(" 动态更新域名解析地址 - 以 Cloudflare 为例")],-1),u=c(`<h2 id="引言" tabindex="-1"><a class="header-anchor" href="#引言" aria-hidden="true">#</a> 引言</h2><p>众所周知，普通加用宽带获取固定公网 IP 极其困难，但目前基本都下发了 IPv6 地址。而获取到的 IPv6 地址并非固定，因此需要定期检查并更新。</p><blockquote><p>传统上，当你连接到互联网时，你的互联网服务提供商（ISP）会为你分配一个独特的IP地址。这个IP地址被用来识别你在互联网上的设备。然而，在某些情况下，这个IP地址可以改变，特别是如果你使用的是动态IP地址。如果你在你的设备上运行需要静态IP地址的服务，如网络服务器，这可能会导致问题。</p><p>DDNS通过提供一种将域名与你的IP地址联系起来的方法来解决这个问题。当你的IP地址改变时，DDNS服务会用新的IP地址更新你的域名的DNS记录。这允许你继续使用相同的域名来访问你的设备，即使IP地址发生变化。</p><p>   —— ChatGPT</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> cloudflare_ddns <span class="token keyword">import</span> CloudFlare
<span class="token keyword">import</span> urllib3

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;./currentip.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    ipv6_prev <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

ipv6 <span class="token operator">=</span> urllib3<span class="token punctuation">.</span>PoolManager<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>request<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> url<span class="token operator">=</span><span class="token string">&#39;http://ipv6.icanhazip.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>ipv6<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>ipv6<span class="token operator">!=</span>ipv6_prev<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;/home/nemo/ddns/currentip.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>ipv6<span class="token punctuation">)</span>

    cf <span class="token operator">=</span> CloudFlare<span class="token punctuation">(</span>
        email<span class="token operator">=</span><span class="token string">&#39;user@hostname.com&#39;</span><span class="token punctuation">,</span>
        api_key<span class="token operator">=</span><span class="token string">&#39;Global_API_Key&#39;</span><span class="token punctuation">,</span>
        domain<span class="token operator">=</span><span class="token string">&#39;example.com&#39;</span><span class="token punctuation">)</span>
    subdomains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;foo.&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bar.&#39;</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> site <span class="token keyword">in</span> subdomains<span class="token punctuation">:</span>
        cf<span class="token punctuation">.</span>create_or_update_record<span class="token punctuation">(</span><span class="token string">&#39;AAAA&#39;</span><span class="token punctuation">,</span> site<span class="token operator">+</span><span class="token string">&#39;example.com&#39;</span><span class="token punctuation">,</span> ipv6<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Update DNS records success.\\n&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Needn\\&#39;t to update DNS records.\\n&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4);function d(k,v){const s=i("decl");return p(),t("div",null,[r,e(s,{aigc:"1",incomp:"1",trans:"1"}),u])}const m=a(l,[["render",d],["__file","ddns.html.vue"]]);export{m as default};
